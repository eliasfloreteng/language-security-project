# Python Pickle Module Offline Tampering Attack

## Background

Python's `pickle` module is used for serializing and deserializing Python objects. "Pickling" converts a Python object hierarchy into a byte stream, and "unpickling" converts that byte stream back into an object hierarchy. While convenient for persisting data or inter-process communication, the `pickle` module is explicitly documented as **not secure** for untrusted data. Maliciously crafted pickle data can lead to arbitrary code execution during the unpickling process. This vulnerability arises because the pickle byte stream contains opcodes that are executed sequentially upon deserialization, including the ability to call arbitrary functions with supplied arguments via the `__reduce__` method.

## Goal

This project aims to explore the security risks associated with Python's `pickle` library. Specifically, we aim to demonstrate how manipulated pickled files can lead to arbitrary code execution. We will also investigate and propose mitigation strategies or alternatives to safely deserialize Python objects.

## Method

To demonstrate the attack, we will create two Python scripts:

1.  `vulnerable_app.py`: This script will simulate a simple application that loads a pickled object from a file. It represents a common scenario where an application might deserialize data without proper validation.
2.  `exploit.py`: This script will craft a malicious pickled payload. The payload will leverage the `__reduce__` method to execute a system command (`echo Malicious code executed!`) when unpickled.
3.  `run_attack.py`: This script will orchestrate the attack by first pickling a benign object, then demonstrating how an attacker could replace it with a malicious payload, and finally showing the vulnerable application unpickling the malicious data.

## Results

When `vulnerable_app.py` attempts to unpickle the malicious data generated by `exploit.py`, the system command embedded within the payload will be executed. This demonstrates the arbitrary code execution vulnerability inherent in unpickling untrusted data. The output "Malicious code executed!" will confirm the successful execution of the injected command.

## References

- [Python `pickle` module documentation](https://docs.python.org/3/library/pickle.html)
- [Exploiting Python pickles - David Hamann](https://davidhamann.de/2020/04/05/exploiting-python-pickle/)
- [Unsafe Deserialization in Python | SecureFlag Security Knowledge Base](https://knowledge-base.secureflag.com/vulnerabilities/unsafe_deserialization/unsafe_deserialization_python.html)
- [The ultimate guide to Python pickle | Snyk](https://snyk.io/blog/guide-to-python-pickle/)
- [Python Pickle Risks and Safer Serialization Alternatives | ArjanCodes](https://arjancodes.com/blog/python-pickle-module-security-risks-and-safer-alternatives/)
